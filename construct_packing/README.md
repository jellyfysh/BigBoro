# Construct Böröczky packings

The arbitrary-precision Python script [`construct_packing.py`](construct_packing.py) implements the construction of 
two-dimensional Böröczky packings in a periodic square box. It allows for the Böröczky or Kahle cores (see Section 2.1.1
of [[Hoellmer2021]](https://arxiv.org/abs/2109.13343)), and connects them to branches with a finite number of layers 
(see Section 2.1.3). The geometric convex polygonal chain A^{geo} with different attenuation parameters phi, and the 
circular A^{circ} are implemented (see Section 2.2.1).

## Installing

The Python script [`construct_packing.py`](construct_packing.py) can be executed with any Python3 implementation. Its
only required external dependency is [NumPy](https://numpy.org). An optional plotting part requires
[Matplotlib](https://matplotlib.org). Both packages can be installed, e.g., using `pip` or `conda` (see
https://numpy.org/install/ and https://matplotlib.org/stable/users/installing.html).

We expect the Python script [`construct_packing.py`](construct_packing.py) to work with any Python3 version and any 
NumPy version. We tested it with cPython 3.9 and NumPy 1.21.

## Using

All parameters for the construction of the Böröczky packing are specified by command-line arguments. In order to get an 
overview over the possible command-line arguments, use:
```
python3 construct_packing.py --help
```
The possible arguments and their default values are as follows:

1. `--core {kahle,boro}`: specify the core (default='kahle')
2. `--chain {geometric,circle}`: specify the shape of the convex polygonal chain (default='geometric')
3. `--layers LAYERS`: set the number of layers > 0 in the (half-)branches (default=5)
4. `--phi PHI`: set the attenuation parameter phi in (0, 1) for the construction of the geometric convex polygonal chain 
(default='0.7')
5. `--file FILE`: set the output filename for the hard-disk packing; if empty, the packing is stored in 
{core}_Layers{l}.txt, where {core} is the used core, and {l} is the number of layers (default='')
6. `--precision PRECISION`: set the precision in decimal digits that is used for the construction (default=50)
7. `--bisection BISECTION`: set the precision {b} of the bisection search for g_2^<, where the result will be correct up 
to 1.0e-{b}; if {b} <= 0, {b} = {p} - 3 is used, with {p} as the precision in decimal digits (default=0)
8. `--plot`: plot and show the constructed hard-disk packing (requires matplotlib)
9. `--version`: show program's version number and exit
10. `-h, --help`: show the help message and exit

The command-line arguments 6 and 7 concern the arbitrary-precision decimal floating-point arithmetic that is used by 
the Python script [`construct_packing.py`](construct_packing.py) (via the 
[`decimal`](https://docs.python.org/3/library/decimal.html) module of Python's standard library). The `--precision` 
argument sets the number of decimal digits, and the `--bisection` argument sets the precision b of the bisection search 
for the value g_2^<  that renders the Böröczky packing compatible with periodic boundary conditions (see Section 2.1.3). 
In general, b should be smaller than the number of decimal digits. The script modifies g_2^< until 
1 <= x_{B_k} - x_{A_k} <= 1 + 10^{-b}. If the bisection search succeeds, the script first tests that no pair of disks 
has a distance smaller than 2 - 10^{-b + 2}. Second, it checks that every disk has at least three contacts with 
distances in the interval [2 - 10^{-b + 2}, 2 + 10^{-b + 2}], and, finally, that the total number of contacts agrees is 
as expected for the given core (see eq. (4) of [[Hoellmer2021]](https://arxiv.org/abs/2109.13343)). 

The final configuration and its parameters (as for example the system length L) are stored in a human-readable format in 
the specified output file of the `--file` command-line argument. The x- and y- positions in the interval [0, L] of the 
hard disks are stored, separated by a space, in each line of the file. The header lines of this file (starting with '#') 
also document the used command-line arguments 

## Examples

The [`example_packings/`](example_packings) directory contains several Böröczky packings generated by the Python script 
[`construct_packing.py`](construct_packing.py). The packings (together with a plot) are contained in corresponding 
subdirectories. The headers of the packing files contain the values of the command-line arguments for 
[`construct_packing.py`](construct_packing.py). The packing 
[`example_packings/kahle_geometric_5/packing.txt`](example_packings/kahle_geometric_5/packing.txt) was constructed, for 
example, with the command:
```
python3 construct_packing.py --core=kahle --chain=geometric --layers=5 --phi=0.7 --file=example_packings/kahle_geometric_5/packing.txt --precision=200 --bisection=100
```
Although the bisection search of the Böröczky-packing construction usually requires an increased precision, the 
high-precision packings with a small enough number of layers may be used as input for standard double-precision 
applications. For simplicity and improved readability, we provide `packing_double.txt` files that store the packings 
with double precision, where applicable.

## Remarks

- In [[Hoellmer2021]](https://arxiv.org/abs/2109.13343), the central simulation box ranges from -L/2 to L/2 in both the 
x and y direction. In contrast, the Python script [`construct_packing.py`](construct_packing.py) considers a central 
simulation box ranging from 0 to L in each direction. This is the same convention that is used in the Go application 
[`go-hard-disks`](../go-hard-disks) of the BigBoro software package. Comment out line 851 
(`all_pts += system_length / Decimal(2)`) of [`construct_packing.py`](construct_packing.py) for the convention of 
[[Hoellmer2021]](https://arxiv.org/abs/2109.13343).
- The required number of decimal digits and the required bisection precision to obtain a Böröczky packing 
depends on the convex polygonal chain and the number of layers in the branches. Usually, the geometric branch requires 
requires higher precision (although this also depends on the attenuation parameter phi). Also, a larger number of layers 
needs a higher precision. Here, the number of decimal digits should always well extend the bisection precision.
- It is possible that the script enters an infinite loop during the bisection search. This can be detected by printing
the running boundaries of the bisection search in the `find_periodic_branch` function. It usually indicates that the 
chosen number of decimal digits is not sufficient.
- It might happen that one of initial boundaries of the bisection search is never changed, in which case the script 
prints a warning. This usually leads to incorrect Böröczky packings and is a sign that the bisection precision was 
chosen too small and that it should be increased (together with the number of decimal digits).
- The final check of the packing for possible (wrong) overlaps and too few contacts currently computes the distance 
between every pair of hard disks. This check thus becomes very slow for large Böröczky packings. 
- For a large number of layers (and especially for the case of the geometric polygonal chain with small attenuation 
parameters), the packing might have more contacts than expected, because the ends of the branches are practically a 
hexagonal packing.
